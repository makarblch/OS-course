## Кулишенко Макар, домашнее задание 8.
### Операционные системы.

**Задание**

Модифицировать последнюю рассмотренную программу таким образом, чтобы данные в буфер записывались по кольцу и читались из него в том же порядке. Синхронизацию читателя и писателя при этом можно не менять. Сохранить также возможность работы одного писателя и одного читателя.

**Решение**

1. Изменим файл common.c

Добавим туда переменную, отвечающую за номер позиции для записи/чтения
```C++
// Номер позиции
int index = -1;
```

Добавим семафоры, которые пригодятся для того, чтобы в функции для определения позиции в один момент мог находится только один читатель/писатель
```C++
// семафор для писателя, который используется в функции получения индекса
const char *writer_sem_pos = "/writer-semaphore-pos";
sem_t *writer_pos;   // указатель на семафор пропуска писателей

// семафор для читателя, который используется в функции получения индекса
const char *reader_sem_pos = "/reader-semaphore-pos";
sem_t *reader_pos;   // указатель на семафор пропуска читателей
```
Добавим функции для получения индекса. Когда писатель записывает данные в ячейку, он увеличивается индекс (обозначая, что ячейку заняли). Когда читатель считывает данные, он наоборот уменьшает индекс, показывая писателям, что в эту ячейку можно снова писать
```C++
// Функция для определения позиции для записи
int get_position_wr() {
  // если в функицю уже зашел один писатель, этот семафор будет ждать его выхода 
  sem_wait(writer_pos);
  ++index;
  if (index >= BUF_SIZE) {
    index = 0;
  }
  sem_post(writer_pos);
  return index;
}

// Функция для определения позиции для чтения
int get_position_rd() {
  // если в функицю уже зашел один читатель, этот семафор будет ждать его выхода 
  sem_wait(reader_pos);
  --index;
  if (index < 0) {
    index = 0;
  }
  sem_post(reader_pos);
  return index;
}
```

2. Изменим reader.c и writer.c. Теперь вместо цикла необходимо вызвать нужную функцию 
```C++
// Writer
int i = get_position_wr();
// Reader
int i = get_position_rd();
```

Спасибо за внимание! (хотим 8)